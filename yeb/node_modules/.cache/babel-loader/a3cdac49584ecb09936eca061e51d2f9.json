{"ast":null,"code":"import router from '../../../router';\nimport store from '../../../store/index';\nimport { initMenu } from '../../../utils/menus';\nexport default {\n  name: 'PermisManna',\n\n  data() {\n    return {\n      role: {\n        name: '',\n        nameZh: ''\n      },\n      roles: [],\n      allMenus: [],\n      defaultProps: {\n        children: 'children',\n        label: 'name'\n      },\n      selectMenus: [],\n      activeName: -1\n    };\n  },\n\n  mounted() {\n    this.initRoles();\n  },\n\n  methods: {\n    cancelUpdate() {\n      this.activeName = -1;\n    },\n\n    doUpdate(rid, index) {\n      let selectKeys = this.$refs.tree[index].getCheckedKeys(true);\n      let data = new Object();\n      data.rid = rid;\n      data.mids = selectKeys;\n      console.log('data:', data);\n      this.putRequest('/system/basic/permiss', data).then(resp => {\n        if (resp) {\n          this.initRoles();\n          this.activeName = -1;\n          initMenu(router, store);\n        }\n      });\n    },\n\n    initSelectMuens(rid) {\n      this.getRequest('/system/basic/permiss/mid?rid=' + rid).then(resp => {\n        if (resp) {\n          this.selectMenus = resp;\n        }\n      });\n    },\n\n    change(rid) {\n      if (rid) {\n        this.initAllMenus();\n        this.initSelectMuens(rid);\n      }\n    },\n\n    initAllMenus() {\n      this.getRequest('/system/basic/permiss/menus').then(resp => {\n        if (resp) {\n          this.allMenus = resp;\n        }\n      });\n    },\n\n    initRoles() {\n      this.getRequest('/system/basic/permiss').then(resp => {\n        if (resp) {\n          this.roles = resp;\n        }\n      });\n    }\n\n  }\n};","map":{"version":3,"mappings":"AAgCA;AACA;AACA;AACA;EACAA,mBADA;;EAEAC;IACA;MACAC;QACAF,QADA;QAEAG;MAFA,CADA;MAKAC,SALA;MAMAC,YANA;MAOAC;QACAC,oBADA;QAEAC;MAFA,CAPA;MAWAC,eAXA;MAYAC;IAZA;EAcA,CAjBA;;EAkBAC;IACA;EACA,CApBA;;EAqBAC;IACAC;MACA;IACA,CAHA;;IAIAC;MACA;MACA;MACAb;MACAA;MACAc;MACA;QACA;UACA;UACA;UACAC;QACA;MACA,CANA;IAOA,CAjBA;;IAkBAC;MACA;QACA;UACA;QACA;MACA,CAJA;IAKA,CAxBA;;IAyBAC;MACA;QACA;QACA;MACA;IACA,CA9BA;;IA+BAC;MACA;QACA;UACA;QACA;MACA,CAJA;IAKA,CArCA;;IAsCAC;MACA;QACA;UACA;QACA;MACA,CAJA;IAKA;;EA5CA;AArBA","names":["name","data","role","nameZh","roles","allMenus","defaultProps","children","label","selectMenus","activeName","mounted","methods","cancelUpdate","doUpdate","console","initMenu","initSelectMuens","change","initAllMenus","initRoles"],"sourceRoot":"src/components/sys/basic","sources":["PermissMana.vue"],"sourcesContent":["<template lang=\"\">\r\n    <div>\r\n        <!-- <div class=\"permissMannaTool\">\r\n            <el-input size=\"small\" placeholder=\"请输入角色英文名\" v-model=\"role.name\" >\r\n                <template slot=\"prepend\">ROLE_</template>\r\n            </el-input>\r\n            <el-input v-model=\"role.nameZh\" size=\"small\" placeholder=\"请输入角色中文名\">\r\n            </el-input>\r\n            <el-button icon=\"el-icon-plus\" type=\"primary\" size=\"small\" @click=\"\">添加角色</el-button>\r\n        </div> -->\r\n        <div class=\"permissMannaMain\">\r\n            <el-collapse v-model=\"activeName\" accordion @change=\"change\">\r\n                <el-collapse-item :title=\"r.nameZh\" :name=\"r.id\" v-for=\"(r, index) in roles\" :key=\"index\">\r\n                    <el-card class=\"box-card\">\r\n                        <div slot=\"header\" class=\"clearfix\">\r\n                          <span>可访问资源</span>\r\n                          <el-button style=\"float: right; padding: 3px 0; color: red;\" type=\"text\" icon=\"el-icon-delete\"></el-button>\r\n                        </div>\r\n                        <div>\r\n                            <el-tree ref=\"tree\" :data=\"allMenus\" :props=\"defaultProps\" show-checkbox :default-checked-keys=\"selectMenus\" node-key=\"id\"></el-tree>\r\n                            <div style=\"display:flex;justify-content:flex-end\">\r\n                                <el-button size=\"mini\" @click=\"cancelUpdate\">取消修改</el-button>\r\n                                <el-button size=\"mini\" type=\"primary\" @click=\"doUpdate(r.id, index)\">确认修改</el-button>\r\n                            </div>\r\n                        </div>\r\n                    </el-card>\r\n                </el-collapse-item>\r\n              </el-collapse>\r\n        </div>\r\n    </div>\r\n</template>\r\n<script>\r\n    import router from '../../../router'\r\n    import store from '../../../store/index'\r\n    import { initMenu } from '../../../utils/menus'\r\nexport default {\r\n    name: 'PermisManna',\r\n    data() {\r\n        return {\r\n            role: {\r\n                name: '',\r\n                nameZh: ''\r\n            },\r\n            roles: [],\r\n            allMenus: [],\r\n            defaultProps: {\r\n                children: 'children',\r\n                label: 'name'\r\n            },\r\n            selectMenus: [],\r\n            activeName: -1,\r\n        }\r\n    },\r\n    mounted(){\r\n        this.initRoles()\r\n    },\r\n    methods: {\r\n        cancelUpdate() {\r\n            this.activeName = -1\r\n        },\r\n        doUpdate(rid, index) {\r\n            let selectKeys = this.$refs.tree[index].getCheckedKeys(true)\r\n            let data = new Object()\r\n            data.rid = rid\r\n            data.mids = selectKeys\r\n            console.log('data:', data)\r\n            this.putRequest('/system/basic/permiss', data).then(resp => {\r\n                if (resp) {\r\n                    this.initRoles()\r\n                    this.activeName = -1\r\n                    initMenu(router, store)\r\n                }\r\n            })\r\n        },\r\n        initSelectMuens(rid) {\r\n            this.getRequest('/system/basic/permiss/mid?rid='+rid).then(resp => {\r\n                if (resp) {\r\n                    this.selectMenus = resp\r\n                }\r\n            })\r\n        },\r\n        change(rid) {\r\n            if (rid) {\r\n                this.initAllMenus()\r\n                this.initSelectMuens(rid)\r\n            }\r\n        },\r\n        initAllMenus() {\r\n            this.getRequest('/system/basic/permiss/menus').then(resp => {\r\n                if (resp) {\r\n                    this.allMenus = resp\r\n                }\r\n            })\r\n        },\r\n        initRoles() {\r\n            this.getRequest('/system/basic/permiss').then(resp => {\r\n                if (resp) {\r\n                    this.roles = resp\r\n                }\r\n            })\r\n        }\r\n    }\r\n}\r\n</script>\r\n<style scoped>\r\n    .permissMannaTool{\r\n        display: flex;\r\n        justify-content: flex-start;\r\n    }\r\n\r\n    .permissMannaTool .el-input {\r\n        width: 300px;\r\n        margin-right: 6px;\r\n    }\r\n    .permissMannaMain{\r\n        margin-top: 10px;\r\n        width: 700px;\r\n    }\r\n</style>"]},"metadata":{},"sourceType":"module"}