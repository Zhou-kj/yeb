{"ast":null,"code":"export default {\n  name: 'DepMana',\n  watch: {\n    filterText(val) {\n      this.$refs.tree.filter(val);\n    }\n\n  },\n\n  data() {\n    return {\n      pname: '',\n      dep: {\n        name: '',\n        parentId: -1\n      },\n      dialogVisible: false,\n      filterText: '',\n      deps: [],\n      defaultProps: {\n        children: 'children',\n        label: 'name'\n      }\n    };\n  },\n\n  mounted() {\n    this.initDeps();\n  },\n\n  methods: {\n    initDep() {\n      this.dep = {\n        name: '',\n        parentId: -1\n      };\n      this.pname = '';\n    },\n\n    // addDepAfter(deps, dep) {\n    //     for (let i = 0 ; i < deps.length ; i ++) {\n    //         let d = deps[i]\n    //         if (d.id == dep.parentId) {\n    //             d.children = d.children.concat(dep)\n    //                 return\n    //         } else {\n    //             this.addDepAfter(d.children, dep)\n    //      }\n    //     }\n    // },  \n    toAdd() {\n      this.postRequest('/system/basic/department', this.dep).then(resp => {\n        if (resp) {\n          this.initDeps();\n          this.initDep();\n          this.dialogVisible = false;\n        }\n      });\n    },\n\n    addDep(data) {\n      this.pname = data.name;\n      this.dep.parentId = data.id;\n      this.dialogVisible = true;\n    },\n\n    delDep(data) {\n      this.$confirm('确认删除该部门, 是否继续?', '提示', {\n        confirmButtonText: '确定',\n        cancelButtonText: '取消',\n        type: 'warning'\n      }).then(() => {\n        this.deleteRequest('/system/basic/department', data).then(resp => {\n          if (resp) {\n            this.initDep();\n            this.initDeps();\n          }\n        });\n      }).catch(() => {\n        this.$message({\n          type: 'info',\n          message: '已取消删除'\n        });\n      });\n    },\n\n    initDeps(val) {\n      this.getRequest('/system/basic/department').then(resp => {\n        if (resp) {\n          this.deps = resp;\n        }\n      });\n    },\n\n    filterNode(value, data) {\n      if (!value) return true;\n      return data.name.indexOf(value) !== -1;\n    }\n\n  }\n};","map":{"version":3,"mappings":"AAkEA;EACAA,eADA;EAEAC;IACAC;MACA;IACA;;EAHA,CAFA;;EAOAC;IACA;MACAC,SADA;MAEAC;QACAL,QADA;QAEAM;MAFA,CAFA;MAMAC,oBANA;MAOAL,cAPA;MAQAM,QARA;MASAC;QACAC,oBADA;QAEAC;MAFA;IATA;EAcA,CAtBA;;EAuBAC;IACA;EACA,CAzBA;;EA0BAC;IACAC;MACA;QACAd,QADA;QAEAM;MAFA;MAIA;IACA,CAPA;;IAQA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACAS;MACA;QACA;UACA;UACA;UACA;QACA;MACA,CANA;IAOA,CA3BA;;IA4BAC;MACA;MACA;MACA;IACA,CAhCA;;IAiCAC;MACA;QACAC,uBADA;QAEAC,sBAFA;QAGAC;MAHA,GAIAC,IAJA,CAIA;QACA;UACA;YACA;YACA;UACA;QACA,CALA;MAMA,CAXA,EAWAC,KAXA,CAWA;QACA;UACAF,YADA;UAEAG;QAFA;MAIA,CAhBA;IAiBA,CAnDA;;IAoDAC;MACA;QACA;UACA;QACA;MACA,CAJA;IAKA,CA1DA;;IA2DAC;MACA;MACA;IACA;;EA9DA;AA1BA","names":["name","watch","filterText","data","pname","dep","parentId","dialogVisible","deps","defaultProps","children","label","mounted","methods","initDep","toAdd","addDep","delDep","confirmButtonText","cancelButtonText","type","then","catch","message","initDeps","filterNode"],"sourceRoot":"src/components/sys/basic","sources":["DepMana.vue"],"sourcesContent":["<template lang=\"\">\r\n    <div style=\"width: 500px;\">\r\n        <el-input\r\n        placeholder=\"输入部门名称进行搜索\"\r\n        prefix-icon=\"el-icon-search\"\r\n        v-model=\"filterText\">\r\n      </el-input>\r\n      \r\n      <el-tree\r\n        :data=\"deps\"\r\n        :props=\"defaultProps\"\r\n        default-expand-all\r\n        :filter-node-method=\"filterNode\"\r\n        :expand-on-click-node=\"false\"\r\n        ref=\"tree\">\r\n        <span class=\"custom-tree-node\" slot-scope=\"{ node, data }\" style=\"display: flex; justify-content: space-between; width: 100%\">\r\n            <span>{{ data.name }}</span>\r\n            <span>\r\n              <el-button\r\n                type=\"primary\"\r\n                size=\"mini\"\r\n                class=\"depBtn\"\r\n                @click=\"() => addDep(data)\">\r\n                添加\r\n              </el-button>\r\n              <el-button\r\n                type=\"danger\"\r\n                size=\"mini\"\r\n                class=\"depBtn\"\r\n                @click=\"() => delDep(data)\">\r\n                删除\r\n              </el-button>\r\n            </span>\r\n          </span>\r\n      </el-tree>\r\n      <el-dialog\r\n      title=\"添加部门\"\r\n      :visible.sync=\"dialogVisible\"\r\n      width=\"30%\">\r\n      <div>\r\n        <table>\r\n            <tr>\r\n                <td>\r\n                    <el-tag>上级部门</el-tag>\r\n                </td>\r\n                <td>{{pname}}</td>\r\n            </tr>\r\n            <tr>\r\n                <td>\r\n                    <el-tag>部门名称</el-tag>\r\n                </td>\r\n                <td>\r\n                    <el-input v-model=\"dep.name\" placeholder=\"请输入部门名称\" size=\"normal\" clearable @change=\"\"></el-input>\r\n                    \r\n                </td>\r\n            </tr>\r\n        </table>\r\n      </div>\r\n      <span slot=\"footer\" class=\"dialog-footer\">\r\n        <el-button @click=\"dialogVisible = false\">取 消</el-button>\r\n        <el-button type=\"primary\" @click=\"toAdd\">确 定</el-button>\r\n      </span>\r\n    </el-dialog>\r\n    </div>\r\n</template>\r\n<script>\r\nexport default {\r\n    name: 'DepMana',\r\n    watch: {\r\n      filterText(val) {\r\n        this.$refs.tree.filter(val);\r\n      }\r\n    },\r\n    data() {\r\n        return {\r\n            pname:'',\r\n            dep:{\r\n                name: '',\r\n                parentId: -1\r\n            },\r\n            dialogVisible: false,\r\n            filterText:'',\r\n            deps: [],\r\n            defaultProps: {\r\n                children: 'children',\r\n                label: 'name'\r\n            }\r\n        }\r\n    },\r\n    mounted() {\r\n        this.initDeps()\r\n    },\r\n    methods: {\r\n        initDep() {\r\n            this.dep = {\r\n                name: '',\r\n                parentId: -1\r\n            }\r\n            this.pname = ''\r\n        },  \r\n        // addDepAfter(deps, dep) {\r\n        //     for (let i = 0 ; i < deps.length ; i ++) {\r\n        //         let d = deps[i]\r\n        //         if (d.id == dep.parentId) {\r\n        //             d.children = d.children.concat(dep)\r\n        //                 return\r\n        //         } else {\r\n        //             this.addDepAfter(d.children, dep)\r\n        //      }\r\n        //     }\r\n        // },  \r\n        toAdd(){\r\n            this.postRequest('/system/basic/department', this.dep).then(resp => {\r\n                if (resp) {\r\n                    this.initDeps()\r\n                    this.initDep()\r\n                    this.dialogVisible = false\r\n                }\r\n            })\r\n        },\r\n        addDep(data) {\r\n            this.pname = data.name\r\n            this.dep.parentId = data.id\r\n            this.dialogVisible = true\r\n        },\r\n        delDep(data) {\r\n            this.$confirm('确认删除该部门, 是否继续?', '提示', {\r\n          confirmButtonText: '确定',\r\n          cancelButtonText: '取消',\r\n          type: 'warning'\r\n        }).then(() => {\r\n            this.deleteRequest('/system/basic/department', data).then(resp => {\r\n                if (resp) {\r\n                    this.initDep()\r\n                    this.initDeps()\r\n                }\r\n            })\r\n        }).catch(() => {\r\n          this.$message({\r\n            type: 'info',\r\n            message: '已取消删除'\r\n          })    \r\n        })\r\n        },\r\n        initDeps(val) {\r\n            this.getRequest('/system/basic/department').then(resp => {\r\n                if (resp) {\r\n                    this.deps = resp\r\n                }\r\n            })\r\n        },\r\n        filterNode(value, data) {\r\n        if (!value) return true;\r\n        return data.name.indexOf(value) !== -1;\r\n      }\r\n    }\r\n}\r\n</script>\r\n<style scoped>\r\n    .depBtn {\r\n        padding: 2px;\r\n    }\r\n</style>"]},"metadata":{},"sourceType":"module"}